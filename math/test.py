import heapq
from collections import defaultdict, Counter

# Créer un noeud d'arbre
class Noeud:
    def __init__(self, char, freq):
        self.char = char
        self.freq = freq
        self.gauche = None
        self.droite = None

    # Comparer les noeuds basés sur la fréquence (pour le tri)
    def __lt__(self, autre):
        return self.freq < autre.freq

# Construire l'arbre de Huffman
def construire_arbre(freq_dict):
    heap = [Noeud(char, freq) for char, freq in freq_dict.items()]
    heapq.heapify(heap)
    
    while len(heap) > 1:
        noeud1 = heapq.heappop(heap)  # Extraire le noeud avec la plus petite fréquence
        noeud2 = heapq.heappop(heap)  # Extraire le second noeud avec la plus petite fréquence

        # Créer un nouveau noeud combinant ces deux noeuds
        nouveau_noeud = Noeud(None, noeud1.freq + noeud2.freq)
        nouveau_noeud.gauche = noeud1
        nouveau_noeud.droite = noeud2

        # Ajouter le nouveau noeud à l'arbre
        heapq.heappush(heap, nouveau_noeud)

    return heap[0]  # L'arbre final

# Générer les codes à partir de l'arbre
def generer_codes(noeud, prefixe="", code_huffman={}):
    if noeud is None:
        return

    # Si c'est une feuille, on a trouvé un caractère
    if noeud.char is not None:
        code_huffman[noeud.char] = prefixe

    # Traverser l'arbre récursivement pour obtenir les codes
    generer_codes(noeud.gauche, prefixe + "0", code_huffman)
    generer_codes(noeud.droite, prefixe + "1", code_huffman)

    return code_huffman

# Encoder un texte en utilisant les codes de Huffman
def encoder_texte(texte, code_huffman):
    return ''.join([code_huffman[char] for char in texte])

# Décoder un texte encodé
def decoder_texte(texte_encode, arbre_huffman):
    noeud = arbre_huffman
    texte_decode = ""
    
    for bit in texte_encode:
        if bit == '0':
            noeud = noeud.gauche
        else:
            noeud = noeud.droite

        if noeud.char is not None:
            texte_decode += noeud.char
            noeud = arbre_huffman

    return texte_decode

# Exemple d'utilisation
texte = "Vous savez, moi je ne crois pas qu’il y ait de bonne ou de mauvaise situation. Moi, si je devais résumer ma vie aujourd’hui avec vous, je dirais que c’est d’abord des rencontres. Des gens qui m’ont tendu la main, peut-être à un moment où je ne pouvais pas, où j’étais seul chez moi. Et c’est assez curieux de se dire que les hasards, les rencontres forgent une destinée... Parce que quand on a le goût de la chose, quand on a le goût de la chose bien faite, le beau geste, parfois on ne trouve pas l’interlocuteur en face je dirais, le miroir qui vous aide à avancer. Alors ça n’est pas mon cas, comme je disais là, puisque moi au contraire, j’ai pu ; et je dis merci à la vie, je lui dis merci, je chante la vie, je danse la vie... je ne suis qu’amour ! Et finalement, quand des gens me disent « Mais comment fais-tu pour avoir cette humanité ? », je leur réponds très simplement que c’est ce goût de l’amour, ce goût donc qui m’a poussé aujourd’hui à entreprendre une construction mécanique... mais demain qui sait ? Peut-être simplement à me mettre au service de la communauté, à faire le don, le don de soi."

# Étape 1 : Calculer la fréquence de chaque caractère dans le texte
frequence = Counter(texte)

# Étape 2 : Construire l'arbre de Huffman
arbre_huffman = construire_arbre(frequence)

# Étape 3 : Générer les codes Huffman pour chaque caractère
codes_huffman = generer_codes(arbre_huffman)
print(arbre_huffman)

# Étape 4 : Encoder le texte
texte_encode = encoder_texte(texte, codes_huffman)
print("Texte encodé :", texte_encode)

texte_encode = '101101000100000011100011110001010010001011000101001100111111011100001001111110010011111001001111101011110100000100110001110100111010100011101001000110101001001000111111011010110111101010011101111111000011111000101010000001000100111110000001111111000011111101111010001101000110101001100001111110001001110110011101011011100100000010010000111000100011000010011100111111000100111111001001111111000011010001101010011000111110101011011100000111011101111010111101111010111010001100101111110100011110010000000111101011000010100010101100111001111101001000101101011111010001000000111000110011111110010011111110001001110101010100110001110100100011011111010110101000111000110111111100001010010100001010100001101011000111110000111000111110100110010010110000001011011110100111000010000111101101000001110001110101010011001010001110100100011100111110111010100000000101101111111011011001011000001111100011101011110111101010010010110011111010011011001111011000100001011000111101111010011111000101111100110010111101110000101110110010110111110000101100010111110010011111001001111101001100000011010001101010011000111010011101010001100111110000101100010111110010010100101101111011101010011000111100001100110001111101011010101101100010100111101110000100101000011110110000111011111010110101000111000110111111010100010000110001010011101011001111010100101100110001000101111100001111110000111111100010011101001111101001000110111110001101110001110101011101010001010110101100010001100111110001101110001111101001100100101100000010110111101001110001110001001000011010010101001100101101111100110010011111110000111000110111001001010110110110100000100000100001111011000001010110100101101111101001000110111110100100011101000101100011100000010111101011100011011111010101000001011001111011111110000111110001110101110101101010110000100001111001111101001000111010001011000111000000101111010111000110111110101010000010110011110111111100001111100011101011101011010101100001000011111000101011001011001011100010011010100111011011110011111000110111110001010101110100011111010101001110001101101111001111101001110101101000010010000100110001110000001011100100111111101111010000000110100010111110100111010100011100011010100100100101101101111010000110000010110011110110110011110101110110010111000100110100101101111111001001111111000100111010101010011000110011111000110111111011110011101000001001110101110100100011100111101000100000011100011110101001110000111110001011111101001000110100010010110111101001000011110110010010001100001101010001111011001000101011100100101000111000110111110100111010100011110111000000101110101110101000110011111010110000101111011101111111001001111111000100110001010100110001110001100010111100111110100110011100110000100100011011111101110000100111110100011111010110000001011011110101010100111010011110011111110010010100101010011110100110011111101101011111101111011111110010011111110001001100011110111011110100101110011110001011111000111010111010001100101111001111111001001111100011001110011111100010011000111101110111101001011100111001111111001001111101011010101110100010110110111110001110101110100011001011110011111110010011111110001010001010000111110001110101110100011001011010000010000010000111110010011111001001111110000011100110001110100100011010100101010111000000111101011110110101011111011000011101111100010011001001010100001101110111011001011011110011111010010001110100010110001111100001110001110101010011001010001111011101111111000100110000110010110111111011010100111000100011101010011000111010110000101111011101100101101111100010011010100110000001000011011001111101001100000011110101111010010001000010011101011101011011110111101101111101010110011101111010001010011101110110111111011001011111011010011110011111110010011111000110110011110101111101010110110100110000001011000100011111011110101011010010100011110001001101110100110001101110111011001011011111010010001101111101011010100011100011011111010110111110101010000010110011110111111100001111100011010100101010111000000111101011001111101011011111010101000001011001111011111110000000001001011111010010001110011111011101010010101110100110000001110001000101101111110100011110010000000111101011000010100010101100111001111000101111101100101101111010011010011110100110010110001101001111100110010011111010110000001010001101111010001101011110111001000000101111011110110110101110100010100101001000110110100000100000100001111011110101001100011111000011101111010100100101110100100011100111110001010100111011111101100101111101100000011001111011000100001011000111101111010011111100010011011101001100011011101110110010110111110001011111101110111111011101111011110111101001111110100011111100001111010010001100101011011111110000111110001110101110101100001011110111001100101010001111011101101111001111100010111110001001101010011101001111100011011111110000000001011001111100011011111110000000001011111000011111100000001001010000'
# Étape 5 : Décoder le texte encodé
texte_decode = decoder_texte(texte_encode, arbre_huffman)
print("Texte décodé :", texte_decode)
